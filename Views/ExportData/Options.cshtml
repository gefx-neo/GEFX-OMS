@using DataAccess.POCO

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.Title = ViewData["SiteName"].ToString();
    ViewBag.PageTitle = "Export Data";
    ViewBag.ExportData = "active open";
}

<div class="panel">
    <div class="panel-body container-fluid">
        <div class="row row-lg">
            <div class="col-xlg-10 col-md-10">
                @if (TempData["Result"] != null)
                {
                    string[] result = TempData["Result"].ToString().Split('|');

                    <div class="alert alert-@result[0]">
                        <button type="button" class="close" data-dismiss="alert">&times;</button>
                        @result[1]
                    </div>
                }

                @using (Html.BeginForm("Options", "ExportData", FormMethod.Post, new { @class = "form-horizontal" }))
                {
                    <div class="form-group">
                        @Html.Label("Table Name:", new { @class = "col-sm-3 control-label" })
                        <div class="col-sm-9">
                            @Html.DropDownList("TableName", (SelectList)ViewData["TableNameDropdown"], new { @class = "form-control" })
                            @Html.ValidationMessage("TableName")
                        </div>
                    </div>
                    <div class="form-group">
                        @Html.Label("From Date:", new { @class = "col-sm-3 control-label" })
                        <div class="col-sm-9">
                            @Html.TextBox("FromDate", ViewData["FromDate"].ToString(), new { @class = "form-control" })
                            @Html.ValidationMessage("FromDate")
                            <span class="help-block"><i class="wb-info-circle"></i> Leave Blank For All Time Data</span>
                        </div>
                    </div>
                    <div class="form-group">
                        @Html.Label("To Date:", new { @class = "col-sm-3 control-label" })
                        <div class="col-sm-9">
                            @Html.TextBox("ToDate", ViewData["ToDate"].ToString(), new { @class = "form-control" })
                            @Html.ValidationMessage("ToDate")
                            <span class="help-block"><i class="wb-info-circle"></i> Leave Blank For All Time Data</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-9 col-sm-offset-3">
                            <button type="submit" class="btn btn-primary">Generate </button>
                            <button type="button" class="btn btn-primary" onclick="DownloadToExcel()">Download to excel</button>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<link rel="stylesheet" href="@Url.Content("~/Content/vendor/bootstrap-datepicker/css/bootstrap-datepicker.css")">
<script src="@Url.Content("~/Content/vendor/bootstrap-datepicker/js/bootstrap-datepicker.js")"></script>

<script>
    $("#FromDate, #ToDate").datepicker({
        autoclose: true,
        format: "dd/mm/yyyy"
    });

    function DownloadToExcel() {
        var tableName = $("#TableName").val();
        var url = "";
        if (tableName == "Customers") {
            url = "@Url.Action("ExportCustomerExcel")";
        }
        else if (tableName == "Product/Inventory") {
            url = "@Url.Action("ExportProductInventoryExcel")";
        }
        else if (tableName = "Sales") {
            url = "@Url.Action("ExportSaleExcel")";
        }
        else if (tableName == "Users") {
            url = "@Url.Action("ExportUserExcel")";
        }
        var fromDate = $("#FromDate").val();
        var toDate = $("#ToDate").val();
        url += "?fromDate=" + fromDate + "&toDate=" + toDate;

        window.location.href = url;
    }
</script>